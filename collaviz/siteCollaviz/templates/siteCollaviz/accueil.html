

{% extends 'base.html' %}
{% load static %}

{% block content %}
{% if request.method == "POST" %}
<button type="button" name="button" onclick="afficherChart({{donnees}})"></button>
{%endif %}
<div class="container">
  <div class="row justify-content-md-center text-center">
    <div id="insertionFichier">
      <h1>Collaviz</h1>
		  <h3>Déposez le fichier à étudier : </h3>
      <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <input  type="file" name="fichier">
        <button type="submit">Déposer</button>
      </form>
  <div id="cont"></div>
  </div>
   </div>
  <div id="previsualisation">
    <div id="employee_table"> </div>

  </div>
</div>


<script type="text/javascript">

function afficherChart(donnees){
  var chart =Highcharts.chart('cont', {
    chart: {
        type: 'column'
    },
    title: {
        text: 'Nombre de connexions de chaque utilisateur'
    },
    xAxis: {
        type: 'category',
        labels: {
            rotation: -45,
            style: {
                fontSize: '13px',
                fontFamily: 'Verdana, sans-serif'
            }
        }
    },
    yAxis: {
        min: 0,
        title: {
            text: 'Nombre de connexions'
        }
    },
    legend: {
        enabled: false
    },
    tooltip: {
        pointFormat: 'Nombre de connexions: <b>{point.y:.1f}</b>'
    },
    series: [{
        name: 'Connexions',
        data: donnees,
        dataLabels: {
            enabled: true,
            rotation: -90,
            color: '#FFFFFF',
            align: 'right',
            y: 10,
            style: {
                fontSize: '13px',
                fontFamily: 'Verdana, sans-serif'
            }
        }
    }]
});


  $("#cont").draggable();
  $("#cont").resizable();
  $("#cont").resize(function() {
  chart.reflow()
});
}
$(document).ready( function () {

    $.ajax({
   url:"../media/tmp/activite.csv",
   dataType:"text",
   success:function(data)
   {
    var employee_data = data.split(/\r?\n|\r/);
    var table_data = '<table id="test" class="table table-bordered table-striped">';
      alert(employee_data)
    for(var count = 0; count<employee_data.length; count++)
    {
     var cell_data = employee_data[count].split(",");
     table_data += '<tr>';
     for(var cell_count=0; cell_count<cell_data.length; cell_count++)
     {
      if(count === 0)
      {
       table_data += '<th>'+cell_data[cell_count]+'</th>';
      }
      else
      {
       table_data += '<td>'+cell_data[cell_count]+'</td>';
      }
     }
     table_data += '</tr>';
    }
    table_data += '</table>';
    $('#employee_table').html(table_data);
   }

  });
 });



</script>


{% endblock %}
